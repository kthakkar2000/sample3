<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kalindi â€” Samsung washing machine 12kg</title>
<link rel="icon" href="assets/ktpl-new-logo.png">
<style>
  :root{
    --bg:#071025;
    --panel:#071424;
    --muted:#9fb0c4;
    --accent1:#ff6b6b;   /* coral */
    --accent2:#5eead4;   /* aqua */
    --glass: rgba(255,255,255,0.03);
    --card-grad: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  html,body{height:100%;margin:0;background:
    radial-gradient(800px 400px at 10% 10%, rgba(94,234,212,0.04), transparent 10%),
    linear-gradient(180deg,var(--bg),#031020); color:#e6f2fb; -webkit-font-smoothing:antialiased;}
  .wrap{max-width:520px;margin:18px auto;padding:16px}

  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:88px;height:88px;border-radius:14px;overflow:hidden;background:#fff;padding:8px;box-shadow:0 12px 40px rgba(3,6,12,0.6)}
  .logo img{width:100%;height:100%;object-fit:contain}
  .brand-info{line-height:1}
  .brand-name{font-weight:900;font-size:18px}
  .brand-sub{color:var(--muted);font-size:12px;margin-top:4px}

  .lang-toggle{display:flex;gap:8px}
  .lang{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer;font-weight:700}
  .lang.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021014;box-shadow:0 12px 30px rgba(94,234,212,0.06)}

  .card{background:var(--card-grad);border-radius:18px;padding:12px;box-shadow:0 18px 50px rgba(2,8,18,0.7)}
  .gallery{position:relative;border-radius:12px;overflow:hidden}
  .slides{display:flex;transition:transform .36s cubic-bezier(.2,.9,.2,1)}
  .slides img{width:100%;height:360px;object-fit:cover;flex-shrink:0;background:#04101a}
  .dots{position:absolute;left:12px;bottom:12px;display:flex;gap:8px}
  .dot{width:10px;height:10px;border-radius:8px;background:rgba(255,255,255,0.06);box-shadow:0 2px 6px rgba(2,8,18,0.6)}
  .dot.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));transform:scale(1.1);box-shadow:0 10px 28px rgba(94,234,212,0.12)}

  .title-row{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  .product-title{font-weight:900;font-size:18px}
  .price{font-weight:900;color:var(--accent2)}

  .muted{color:var(--muted);font-size:13px;margin-top:8px}

  .specs{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:12px}
  .spec{background:var(--glass);padding:10px;border-radius:10px;font-size:13px;color:#e6f2fb}

  .assistant{display:flex;gap:12px;align-items:center;margin-top:14px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(255,107,107,0.04), rgba(94,234,212,0.03)) }
  .mic{width:62px;height:62px;border-radius:12px;background:linear-gradient(180deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:22px;color:#021014;cursor:pointer;border:0;box-shadow:0 10px 30px rgba(2,8,18,0.6)}
  .mic.listening{transform:scale(1.05);box-shadow:0 20px 50px rgba(94,234,212,0.18)}
  .assistant-info{flex:1}
  .assistant-title{font-weight:800}
  .assistant-sub{font-size:13px;color:var(--muted);margin-top:6px}
  .transcript{margin-top:8px;color:var(--muted);font-size:14px;min-height:40px}

  /* chat */
  .chat{margin-top:14px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px}
  .messages{max-height:260px;overflow:auto;display:flex;flex-direction:column;gap:10px;padding-right:6px}
  .bubble{padding:10px 12px;border-radius:12px;max-width:80%;font-size:14px;line-height:1.35}
  .bubble.user{align-self:flex-end;background:linear-gradient(90deg,var(--accent2),#10b981);color:#03201c}
  .bubble.bot{align-self:flex-start;background:rgba(255,255,255,0.04);color:#e9f6fb}
  .input-row{display:flex;gap:8px;align-items:center}
  .input-row input{flex:1;padding:12px;border-radius:10px;border:0;background:transparent;color:inherit;font-size:15px;outline:none}
  .btn-send{padding:10px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#021014;cursor:pointer;font-weight:800}
  .btn-voice{padding:10px;border-radius:10px;border:0;background:#05202a;color:#9feee0;cursor:pointer}

  footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}

  /* responsive */
  @media (max-width:420px){
    .slides img{height:260px}
    .logo{width:64px;height:64px}
    .shop-title{font-size:15px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo"><img id="logo" src="assets/ktpl-new-logo.png" alt="Kalindi logo"></div>
        <div class="brand-info">
          <div class="brand-name">Kalindi Tradelinks Pvt Ltd</div>
          <div class="brand-sub">Home Appliances â€¢ Washing Machine</div>
        </div>
      </div>

      <div class="lang-toggle" role="tablist" aria-label="Language">
        <button class="lang active" id="lang-en">English</button>
        <button class="lang" id="lang-gu">àª—à«àªœàª°àª¾àª¤à«€</button>
      </div>
    </header>

    <main class="card" role="main">
      <div class="gallery" id="gallery">
        <div class="slides" id="slides">
          <!-- images will be populated by script (keeps markup clean) -->
        </div>
        <div class="dots" id="dots" aria-hidden="true"></div>
      </div>

      <div class="title-row">
        <div class="product-title" id="productTitle">Samsung washing machine 12kg</div>
        <div class="price" id="price">â‚¹65,000</div>
      </div>
      <div class="muted" id="rating">4.7 â˜… â€¢ 2 year warranty</div>

      <div class="specs" id="specs">
        <!-- specs populated by script -->
      </div>

      <div class="assistant" role="region" aria-label="Voice assistant">
        <button class="mic" id="mainMic" title="Tap to speak" aria-pressed="false">ğŸ™ï¸</button>
        <div class="assistant-info">
          <div class="assistant-title" id="assistantTitle">Product Voice Assistant</div>
          <div class="assistant-sub" id="assistantSub">Tap mic or type â€” answers in English & Gujarati.</div>
          <div class="transcript" id="transcript">Assistant ready. Select language and tap mic or type your question.</div>
        </div>
      </div>

      <div class="chat" aria-live="polite">
        <div class="messages" id="messages" role="log" aria-relevant="additions"></div>
        <div class="input-row">
          <input id="chatInput" placeholder="Type your question..." autocomplete="off" />
          <button class="btn-send" id="sendBtn">Send</button>
          <button class="btn-voice" id="chatMic" title="Speak from chat">ğŸ™ï¸</button>
        </div>
      </div>

    </main>

    <footer>Â© Kalindi Tradelinks Pvt Ltd</footer>
  </div>

<script>
/* Single-file product + assistant (copy-paste ready).
   Requirements: put product images and logo in assets/ folder:
   assets/ktpl-new-logo.png
   assets/wm1.jpg ... assets/wm5.jpg
*/

document.addEventListener('DOMContentLoaded', () => {
  // ---------- product data ----------
  const PRODUCT = {
    id: 'samsung-12kg',
    title: 'Samsung washing machine 12kg',
    price: 'â‚¹65,000',
    rating: '4.7 â˜… â€¢ 2 year warranty',
    images: ['assets/wm1.jpg','assets/wm2.jpg','assets/wm3.jpg','assets/wm4.jpg','assets/wm5.jpg'],
    specs: {
      'Capacity': '12 kg',
      'Energy': '5 Star',
      'RPM': '1200',
      'Warranty': '2 years'
    },
    description_en: 'Samsung 12 kg front-load washers combine AI wash optimisation, Digital Inverter motor, Quick/Eco programs, and SmartThings on select models.',
    description_gu: 'Samsung 12 kg àª«à«àª°àª¨à«àªŸ-àª²à«‹àª¡ àªµà«‹àª¶àª°à«àª¸àª®àª¾àª‚ AI àªµà«‹àª¶, àª¡àª¿àªœàª¿àªŸàª² àª‡àª¨àªµàª°à«àªŸàª° àª®à«‹àªŸàª°, àª•à«àªµàª¿àª•/àªàª•à«‹ àªªà«àª°à«‹àª—à«àª°àª¾àª® àª…àª¨à«‡ SmartThings àª¸àªªà«‹àª°à«àªŸ àª¹à«‹àª¯ àª›à«‡.'
  };

  // populate UI
  document.getElementById('productTitle').textContent = PRODUCT.title;
  document.getElementById('price').textContent = PRODUCT.price;
  document.getElementById('rating').textContent = PRODUCT.rating;

  const specsEl = document.getElementById('specs');
  specsEl.innerHTML = '';
  for(const [k,v] of Object.entries(PRODUCT.specs)){
    const d = document.createElement('div'); d.className='spec';
    d.innerHTML = `<strong>${k}</strong><div style="color:var(--muted);margin-top:6px">${v}</div>`;
    specsEl.appendChild(d);
  }

  // ---------- slider build ----------
  const slides = document.getElementById('slides'), dots = document.getElementById('dots');
  function buildSlides(){
    slides.innerHTML=''; dots.innerHTML='';
    PRODUCT.images.forEach((src,i) => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = PRODUCT.title + ' image ' + (i+1);
      img.addEventListener('error', ()=> { img.style.display='none'; showImageError(); });
      slides.appendChild(img);
      const dot = document.createElement('div');
      dot.className = 'dot' + (i===0 ? ' active' : '');
      dot.addEventListener('click', ()=> { index=i; updateSlide(); });
      dots.appendChild(dot);
    });
  }
  function showImageError(){
    const g = document.getElementById('gallery');
    // Optional: show small overlay if images missing
  }
  let index = 0;
  function updateSlide(){ slides.style.transform = `translateX(${-index*100}%)`; Array.from(dots.children).forEach((d,i)=> d.classList.toggle('active', i===index)); }
  buildSlides();
  setInterval(()=> { if(slides.children.length){ index = (index+1) % slides.children.length; updateSlide(); } }, 4500);

  // swipe support
  let startX = null;
  const gallery = document.getElementById('gallery');
  gallery.addEventListener('touchstart', e => startX = e.changedTouches[0].clientX);
  gallery.addEventListener('touchend', e => {
    if(startX === null) return;
    const endX = e.changedTouches[0].clientX; const dx = endX - startX;
    if(Math.abs(dx) > 40){
      if(dx < 0) index = Math.min(index+1, slides.children.length-1);
      else index = Math.max(index-1, 0);
      updateSlide();
    }
    startX = null;
  });

  // ---------- language toggle ----------
  let currentLang = 'en';
  const langEn = document.getElementById('lang-en'), langGu = document.getElementById('lang-gu');
  function setLang(l){
    currentLang = l;
    if(l==='en'){ langEn.classList.add('active'); langGu.classList.remove('active'); document.getElementById('assistantSub').textContent='Tap mic or type â€” answers in English & Gujarati.'; }
    else { langGu.classList.add('active'); langEn.classList.remove('active'); document.getElementById('assistantSub').textContent='àª®àª¾àª‡àª• àª¦àª¬àª¾àªµà«‹ àª…àª¥àªµàª¾ àª²àª–à«‹ â€” àªœàªµàª¾àª¬ àª…àª‚àª—à«àª°à«‡àªœà«€ àª…àª¨à«‡ àª—à«àªœàª°àª¾àª¤à«€ àª®àª¾àª‚.'; }
    if(recognition) recognition.lang = (currentLang==='en' ? 'en-IN' : 'gu-IN');
  }
  langEn.addEventListener('click', ()=> setLang('en'));
  langGu.addEventListener('click', ()=> setLang('gu'));

  // ---------- canned prompts (product-specific first) ----------
  const PRODUCT_PROMPTS = [
    { q: /price|cost|â‚¹|rupee/i, en: `The price of this model is ${PRODUCT.price}.`, gu: `àª† àª®à«‹àª¡à«‡àª²àª¨à«€ àª•àª¿àª‚àª®àª¤ ${PRODUCT.price} àª›à«‡.` },
    { q: /stock|available/i, en: 'Stock varies by store. Please contact us to confirm availability.', gu: 'àª¸à«àªŸà«‹àª• àª¸à«àªŸà«‹àª° àªªàª° àª†àª§àª¾àª° àª°àª¾àª–à«‡ àª›à«‡. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¸à«àªŸà«‹àª°àª®àª¾àª‚ àªœà¤¾à¤à¤šà«‹.' },
    { q: /warrant(?:y|ies)|guarantee/i, en: 'This product comes with a 2 year manufacturer warranty covering defects and parts.', gu: 'àª† àª‰àª¤à«àªªàª¾àª¦àª¨ àª¸àª¾àª¥à«‡ 2 àªµàª°à«àª·àª¨à«€ àªµà«‹àª°àª‚àªŸà«€ àª®àª³à«‡ àª›à«‡.' },
    { q: /usage|how to use|how do i use/i, en: 'Load clothes evenly, use recommended detergent, select the correct program and avoid overloading.', gu: 'àª•àªªàª¡àª¾àª‚ àª¸àª®àª¾àª¨ àª°à«€àª¤à«‡ àª²à«‹àª¡ àª•àª°à«‹, àª¸à«‚àªšàª¿àª¤ àª¡àª¿àªŸàª°à«àªœàª¨à«àªŸ àªµàª¾àªªàª°à«‹ àª…àª¨à«‡ àª“àªµàª°àª²à«‹àª¡ àªŸàª¾àª³à«‹.' },
    { q: /water|litre|consumption/i, en: 'Approx 50â€“70 litres per full wash depending on program.', gu: 'àªªà«àª°à«àª£ àªµà«‹àª¶ àª®àª¾àªŸà«‡ àª†àª¶àª°à«‡ 50â€“70 àª²àª¿àªŸàª° àªªàª¾àª£à«€ àªµàªªàª°àª¾àª¯ àª›à«‡.' },
    { q: /colour|color|available color/i, en: 'Common colours: Pearl White, Graphite Silver; availability depends on stock.', gu: 'àªªà«àª°àª¾àªªà«àª¤ àª°àª‚àª—à«‹: àªªàª°à«àª² àªµà«àª¹àª¾àª‡àªŸ, àª—à«àª°àª¾àª«àª¾àª‡àªŸ àª¸àª¿àª²à«àªµàª° â€” àª¸à«àªŸà«‹àª• àªªàª° àª†àª§àª¾àª°.' },
    { q: /dimension|size|height|width|depth/i, en: PRODUCT.specs?.dimensions || 'Approx H 85 Ã— W 60 Ã— D 55â€“70 cm', gu: PRODUCT.specs?.dimensions || 'àª…àª‚àª¦àª¾àªœàª¿àª¤ àª®àª¾àªª: H 85 Ã— W 60 Ã— D 55â€“70 àª¸à«‡àª®à«€' },
    { q: /electric|power|watt|energy/i, en: 'Typical energy per full wash is around 1.2â€“1.5 kWh; eco modes reduce energy use.', gu: 'àªªà«‚àª°àª¨àª¾ àªµà«‹àª¶ àª®àª¾àªŸà«‡ àª…àª‚àª¦àª¾àªœà«‡ 1.2â€“1.5 kWh àªŠàª°à«àªœàª¾ àªµàªªàª°àª¾àª¯ àª›à«‡.' },
    { q: /dryer|dry function/i, en: 'Some variants are washer-dryer combos â€” check the specific model for dryer capability.', gu: 'àª•à«‡àªŸàª²àª¾àª‚àª• àª®à«‹àª¡à«‡àª² àªµà«‹àª¶àª°-àª¡à«àª°àª¾àª¯àª° àª•à«‰àª®à«àª¬à«‹ àª¹à«‹àªˆ àª¶àª•à«‡ àª›à«‡; àªšà«‹àª•à«àª•àª¸ àª®àª¾àª¡à«‡àª² àª¤àªªàª¾àª¸à«‹.' },
    { q: /inverter|digital inverter|motor/i, en: 'Yes â€” modern Samsung front-load machines use a Digital Inverter Motor for efficiency and durability.', gu: 'àª¹àª¾ â€” àª†àª§à«àª¨àª¿àª• àª®à«‹àª¡à«‡àª²àª®àª¾àª‚ àª¡àª¿àªœàª¿àªŸàª² àª‡àª¨àªµàª°à«àªŸàª° àª®à«‹àªŸàª° àª¹à«‹àª¯ àª›à«‡.' },
    { q: /advantages|why should i buy|benefit/i, en: 'Advantages: large capacity, efficient inverter motor, advanced wash programs and smart features on select models.', gu: 'àª²àª¾àª­: àª®à«‹àªŸà«€ àª•à«àª·àª®àª¤àª¾, àª•àª¾àª°à«àª¯àª•à«àª·àª® àª‡àª¨àªµàª°à«àªŸàª° àª®à«‹àªŸàª°, àª…àª¦à«àª¯àª¤àª¨ àªªà«àª°à«‹àª—à«àª°àª¾àª® àª…àª¨à«‡ àª•à«‡àªŸàª²àª¾àª• àª®à«‹àª¡à«‡àª²àª®àª¾àª‚ àª¸à«àª®àª¾àª°à«àªŸ àª¸à«àªµàª¿àª§àª¾àª“.' },
    { q: /smaller|instead of a smaller capacity/i, en: '12kg handles bulky items and heavy loads in fewer cycles â€” saving time and energy.', gu: '12 kg àª®à«‹àªŸàª¾ àª²à«‹àª¡àª¨à«‡ àª“àª›àª¾ àª¸àª¾àª¯àª•àª²àª®àª¾àª‚ àª§à«‹àªˆ àª¶àª•à«‡ àª›à«‡ â€” àª¸àª®àª¯ àª…àª¨à«‡ àªŠàª°à«àªœàª¾ àª¬àªšàª¾àªµà«‡ àª›à«‡.' },
    { q: /programs|quick wash|eco wash|special programs/i, en: 'Yes â€” many models include Quick Wash, Eco mode and Hygiene/Steam cycles.', gu: 'àª¹àª¾ â€” àª•à«àªµàª¿àª• àªµà«‹àª¶, àªàª•à«‹ àª®à«‹àª¡ àª…àª¨à«‡ àª¸à«àªŸà«€àª®/àª¹àª¾àªˆàªœà«‡àª¨ àªªà«àª°à«‹àª—à«àª°àª¾àª® àª‰àªªàª²àª¬à«àª§ àª›à«‡.' },
    { q: /heavy loads|blankets|curtains/i, en: 'Yes â€” 12 kg is suitable for blankets, curtains and other bulky items.', gu: 'àª¹àª¾ â€” 12 kg àª­àª¾àª°à«‡ àª²à«‹àª¡ àª®àª¾àªŸà«‡ àª¯à«‹àª—à«àª¯ àª›à«‡.' },
    { q: /feedback|reviews|customer review/i, en: 'Sample feedback: 1) Great cleaning. 2) Large drum â€” great for bedding. 3) Smart features useful. 4) Quiet operation.', gu: 'àª—à«àª°àª¾àª¹àª• àªªà«àª°àª¤àª¿àª¸àª¾àª¦: 1) àª¸àª¾àª°à«€ àª¸àª«àª¾àªˆ. 2) àª®à«‹àªŸà«€ àª¡à«àª°àª®. 3) àª¸à«àª®àª¾àª°à«àªŸ àª«à«€àªšàª°à«àª¸ àª‰àªªàª¯à«‹àª—à«€. 4) àª¶àª¾àª‚àª¤.' }
  ];

  const GLOBAL_PROMPTS = [
    { q: /service|repair|support/i, en: 'We provide doorstep service and free checkups during warranty period. Contact store.', gu: 'àªµà«‹àª°àª‚àªŸà«€ àª¦àª°àª®àª¿àª¯àª¾àª¨ àª¡à«‹àª°àª¸à«àªŸà«‡àªª àª¸àª°à«àªµàª¿àª¸ àª…àª¨à«‡ àª®àª«àª¤ àªšà«‡àª•àª…àªª àª‰àªªàª²àª¬à«àª§ àª›à«‡. àª¸à«àªŸà«‹àª° àª¸àª‚àªªàª°à«àª• àª•àª°à«‹.' },
    { q: /offer|discount|sale/i, en: 'Festive discounts available occasionally â€” check in-store for current offers.', gu: 'àª¤àª¹à«‡àªµàª¾àª°à«€àª“ àª¦àª°àª®àª¿àª¯àª¾àª¨ àª¡àª¿àª¸à«àª•àª¾àª‰àª¨à«àªŸ àª‰àªªàª²àª¬à«àª§ â€” àª¸à«àªŸà«‹àª°àª®àª¾àª‚ àª¤àªªàª¾àª¸à«‹.' }
  ];

  function findAnswer(text){
    const q = text.toLowerCase();
    for(const p of PRODUCT_PROMPTS){
      if(p.q.test(q)) return (currentLang==='en' ? p.en : p.gu);
    }
    for(const g of GLOBAL_PROMPTS){
      if(g.q.test(q)) return (currentLang==='en' ? g.en : g.gu);
    }
    // describe long only when asked for 'describe' or 'details'
    if(/describe|description|details|model description|all description/i.test(q)){
      return currentLang==='en' ? PRODUCT.description_en : PRODUCT.description_gu;
    }
    return null;
  }

  // ---------- speech synthesis + tap sound ----------
  function speak(text){
    if(!('speechSynthesis' in window)) return;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = (currentLang === 'en' ? 'en-IN' : 'gu-IN');
    u.rate = 1;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }

  let audioCtx = null;
  function playTap(){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      o.frequency.setValueAtTime(1200, now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.12, now + 0.002);
      g.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(now); o.stop(now + 0.14);
    }catch(e){ /* ignore */ }
  }

  // ---------- recognition (with fallback) ----------
  let recognition = null;
  let heardThisSession = false;
  if(window.SpeechRecognition || window.webkitSpeechRecognition){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.lang = 'en-IN';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = (ev) => {
      heardThisSession = true;
      const txt = ev.results[0][0].transcript;
      addMessage(txt, 'user');
      processQuery(txt);
    };
    recognition.onend = () => {
      document.getElementById('mainMic').classList.remove('listening');
      if(!heardThisSession){
        document.getElementById('transcript').textContent = (currentLang==='en' ? 'Tap mic to speak' : 'àª®àª¾àª‡àª• àª¦àª¬àª¾àªµà«‹ àª…àª¨à«‡ àª¬à«‹àª²à«‹');
      }
      heardThisSession = false;
    };
    recognition.onerror = (ev) => {
      document.getElementById('transcript').textContent = 'Error: ' + (ev.error || ev.message);
      document.getElementById('mainMic').classList.remove('listening');
      heardThisSession = false;
    };
  }

  // ---------- chat UI ----------
  const messages = document.getElementById('messages');
  function addMessage(text, who='user'){
    const b = document.createElement('div'); b.className = 'bubble ' + (who==='user' ? 'user' : 'bot'); b.textContent = text;
    messages.appendChild(b); messages.scrollTop = messages.scrollHeight;
  }

  function respond(text){
    if(!text) text = (currentLang==='en' ? "Sorry, I don't have that info. Ask about price, usage, warranty or features." : "àª®àª¾àª« àª•àª°àª¶à«‹, àª®àª¾àª°à«€ àªªàª¾àª¸à«‡ àª¤à«‡ àª®àª¾àª¹àª¿àª¤à«€ àª¨àª¥à«€. àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¬à«€àªœàª¾ àªªà«àª°àª¶à«àª¨ àªªà«‚àª›à«‹.");
    document.getElementById('transcript').textContent = (currentLang==='en' ? 'Assistant: ' : 'àª¸àª¹àª¾àª¯àª•: ') + text;
    addMessage(text, 'bot');
    speak(text);
  }

  function processQuery(text){
    const ans = findAnswer(text);
    if(ans){ respond(ans); return; }
    // fallback: show generic message
    respond(null);
  }

  // ---------- main mic behavior ----------
  const mainMic = document.getElementById('mainMic');
  mainMic.addEventListener('click', ()=>{
    playTap();
    if(!recognition){
      const q = prompt(currentLang === 'en' ? 'Type your question:' : 'àª¤àª®àª¾àª°à«‹ àªªà«àª°àª¶à«àª¨ àª…àª¹à«€àª‚ àª²àª–à«‹:');
      if(q){ addMessage(q,'user'); processQuery(q); }
      return;
    }
    mainMic.classList.add('listening');
    document.getElementById('transcript').textContent = (currentLang==='en' ? 'Listening...' : 'àª¶à«àª£àªµàª¾àª®àª¾àª‚ àª†àªµà«€ àª°àª¹à«àª¯à«àª‚ àª›à«‡...');
    heardThisSession = false;
    recognition.lang = (currentLang === 'en' ? 'en-IN' : 'gu-IN');
    try{ recognition.start(); }catch(e){ mainMic.classList.remove('listening'); }
  });

  // ---------- chat send / chat mic ----------
  const chatInput = document.getElementById('chatInput'), sendBtn = document.getElementById('sendBtn'), chatMic = document.getElementById('chatMic');
  sendBtn.addEventListener('click', ()=> { const v = chatInput.value.trim(); if(!v) return; addMessage(v,'user'); chatInput.value=''; processQuery(v); });
  chatInput.addEventListener('keydown', e => { if(e.key === 'Enter'){ e.preventDefault(); sendBtn.click(); } });

  chatMic.addEventListener('click', ()=>{
    playTap();
    if(!recognition){
      const q = prompt(currentLang === 'en' ? 'Type your question:' : 'àª¤àª®àª¾àª°à«‹ àªªà«àª°àª¶à«àª¨ àª…àª¹à«€àª‚ àª²àª–à«‹:');
      if(q){ addMessage(q,'user'); processQuery(q); }
      return;
    }
    mainMic.classList.add('listening');
    document.getElementById('transcript').textContent = (currentLang==='en' ? 'Listening...' : 'àª¶à«àª£àªµàª¾àª®àª¾àª‚ àª†àªµà«€ àª°àª¹à«àª¯à«àª‚ àª›à«‡...');
    heardThisSession = false;
    recognition.lang = (currentLang === 'en' ? 'en-IN' : 'gu-IN');
    try{ recognition.start(); }catch(e){ mainMic.classList.remove('listening'); }
  });

  // accessibility: keyboard activate main mic
  mainMic.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') e.target.click(); });

  // ---------- initial setup ----------
  setLang('en'); // set default
  document.getElementById('transcript').textContent = 'Assistant ready. Select language and tap mic or type your question.';

}); // DOMContentLoaded end
</script>
</body>
</html>
