<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Kalindi ‚Äî TCL 43" P6K (43P6K)</title>
<style>
  :root{
    --bg:#071226; --muted:#9fb0c4; --accent:#00e6d8; --accentWarm:#ff6b57; --txt:#e9f8ff;
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#041021);color:var(--txt);-webkit-font-smoothing:antialiased}
  .wrap{max-width:980px;margin:8px auto;padding:12px}

/* header left aligned with logo (wider) */
header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.logo-box{width:132px;height:84px;border-radius:12px;overflow:hidden;background:#fff;padding:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;box-shadow:0 12px 36px rgba(2,8,18,0.6)}
.logo-box img{width:100%;height:100%;object-fit:contain}
.brand{display:flex;flex-direction:column}
.brand .name{font-weight:900;font-size:18px}
.brand .sub{font-size:12px;color:var(--muted);margin-top:4px}

/* language toggle top-right */
.lang-toggle{margin-left:auto;display:flex;gap:8px;z-index:6000}
.lang-btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);cursor:pointer;font-weight:800;touch-action:manipulation}
.lang-btn.active{background:linear-gradient(90deg,var(--accent),#6df0c8);color:#022426}

/* product card */
.card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:14px;padding:12px;box-shadow:0 24px 60px rgba(2,8,18,0.6);position:relative}

.title-row{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:10px}
.product-name{font-weight:900;font-size:18px}
.product-size{color:var(--muted);font-size:13px}

/* carousel */
.carousel{position:relative;border-radius:12px;overflow:hidden;background:#000;margin-bottom:12px}
.slides{display:flex;transition:transform .36s cubic-bezier(.2,.9,.2,1);will-change:transform}
.slides img{width:100%;height:260px;object-fit:cover;flex-shrink:0;display:block}
@media(min-width:640px){ .slides img{height:340px} }
.dots{display:flex;gap:8px;padding:10px;justify-content:center}
.dot{width:9px;height:9px;border-radius:8px;background:rgba(255,255,255,0.06)}
.dot.active{background:linear-gradient(90deg,var(--accent),var(--accentWarm));box-shadow:0 10px 26px rgba(0,230,216,0.07)}
.nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,0.5);border-radius:10px;padding:8px;border:0;color:var(--txt);cursor:pointer;z-index:3000;touch-action:manipulation}
.nav-btn.prev{left:8px}
.nav-btn.next{right:8px}

/* centered action buttons (with small logo icon inside) */
.center-actions{display:flex;gap:12px;justify-content:center;margin:10px 0 0}
.center-actions button{padding:12px 18px;border-radius:12px;border:0;cursor:pointer;font-weight:900;background:linear-gradient(90deg,var(--accent),#6df0c8);color:#022426;box-shadow:0 14px 40px rgba(0,230,216,0.06);touch-action:manipulation;display:flex;align-items:center;gap:10px}
.center-actions button.voice{background:linear-gradient(90deg,var(--accentWarm),#ffb085);color:#081217}
.center-actions img.icon{width:26px;height:26px;border-radius:6px;object-fit:contain;background:#fff;padding:3px}

/* panel */
.panel{position:fixed;right:14px;bottom:calc(14px + env(safe-area-inset-bottom));width:92vw;max-width:420px;height:62vh;background:linear-gradient(180deg,#071726,#03202b);border-radius:12px;padding:8px;box-shadow:0 28px 80px rgba(2,8,18,0.7);display:none;flex-direction:column;z-index:6500}
.panel header{display:flex;align-items:center;justify-content:space-between;padding:8px 6px;border-bottom:1px solid rgba(255,255,255,0.03)}
.panel .h-title{font-weight:800}
.panel .h-sub{font-size:12px;color:var(--muted)}
.panel .messages{flex:1;padding:10px;overflow:auto;display:flex;flex-direction:column;gap:8px}
.bubble{max-width:78%;padding:10px 12px;border-radius:12px;line-height:1.35;word-break:break-word}
.bubble.user{align-self:flex-end;background:linear-gradient(90deg,var(--accentWarm),#ffb085);color:#081217}
.bubble.bot{align-self:flex-start;background:rgba(255,255,255,0.03);color:var(--txt)}
.panel .composer{display:flex;gap:8px;padding:8px;border-top:1px solid rgba(255,255,255,0.03)}
.panel input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--txt);outline:none}

/* tweak when keyboard opens: JS will adjust scroll */
footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}

@media(max-width:480px){
  .logo-box{width:110px;height:64px;padding:8px}
  .slides img{height:200px}
}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo-box"><img id="logo" alt="Kalindi logo"></div>
      <div class="brand">
        <div class="name">Kalindi Tradelinks Pvt Ltd</div>
        <div class="sub">TV ‚Ä¢ Electronics ‚Ä¢ Showroom</div>
      </div>

      <div class="lang-toggle" style="margin-left:auto">
        <button id="langEn" class="lang-btn active">English</button>
        <button id="langGu" class="lang-btn">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</button>
      </div>
    </header>

    <main class="card" aria-labelledby="prodTitle">
      <div class="title-row">
        <div>
          <div id="prodTitle" class="product-name">TCL 43" P6K 4K HDR TV ‚Äî 43P6K</div>
          <div id="prodSize" class="product-size">43 inch (109 cm)</div>
        </div>
      </div>

      <div class="carousel" id="carousel">
        <button class="nav-btn prev" id="prevBtn" aria-label="Previous">‚óÄ</button>
        <div class="slides" id="slides" aria-live="polite" role="group"></div>
        <button class="nav-btn next" id="nextBtn" aria-label="Next">‚ñ∂</button>
      </div>
      <div class="dots" id="dots" aria-hidden="true"></div>

      <div class="center-actions">
        <button id="askBtn"><img class="icon" id="btnLogo1" alt="logo icon"> Ask Me</button>
        <button id="assistBtn" class="voice"><img class="icon" id="btnLogo2" alt="logo icon"> Product Assistant</button>
      </div>
    </main>

    <footer>¬© Kalindi Tradelinks Pvt Ltd</footer>
  </div>

  <div class="panel" id="panel" role="dialog" aria-hidden="true">
    <header>
      <div>
        <div class="h-title" id="panelTitle">Product Assistant</div>
        <div class="h-sub" id="panelSub">Tap mic or type your question</div>
      </div>
      <div><button id="closePanel" style="background:transparent;border:0;color:var(--muted);cursor:pointer">‚úï</button></div>
    </header>
    <div class="messages" id="messages" aria-live="polite"></div>
    <div class="composer">
      <input id="inputBox" placeholder="Type your question..." aria-label="Type your question">
      <button id="sendBtn" class="btn">Send</button>
      <button id="micBtn" class="btn" style="background:linear-gradient(180deg,var(--accentWarm),#ffb085);color:#081217">üé§</button>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // ---------------- image loader (use your exact logo filename) ----------------
  const logoPaths = ['assets/ktpl-new-logo.jpg','assets/ktpl new logo.jpg','assets/ktpl-new-logo.png','assets/ktpl new logo.png'];
  const slideBases = ['assets/fron.webp','assets/front2.webp','assets/front3.webp','assets/side2.webp','assets/side1.webp,'top.webp'];
  const featureBases = []; // not used now

  const exts = ['.avif','.webp','.jpg','.jpeg','.png'];

  // helper: try many variants for a base
  function tryLoad(baseList, imgEl, hideIfFail=true){
    let i=0;
    const queue=[];
    baseList.forEach(b=>{
      if(/\.[a-zA-Z]{2,4}$/.test(b)) queue.push(b);
      else exts.forEach(e=>queue.push(b+e));
    });
    function next(){
      if(i>=queue.length){ if(hideIfFail) imgEl.style.display='none'; return; }
      const s = queue[i++];
      const t = new Image();
      t.onload = ()=> { imgEl.src = s; };
      t.onerror = next;
      t.src = s;
    }
    next();
  }

  // set main logo (left)
  const logoEl = document.getElementById('logo');
  // support older template where id is 'logo' or 'logoImg' - fallback:
  const logoBoxImg = document.querySelector('.logo-box img') || document.getElementById('logoImg') || document.getElementById('logo');
  if(logoBoxImg) tryLoad(logoPaths, logoBoxImg);

  // set small icons for buttons
  const btnLogo1 = document.getElementById('btnLogo1');
  const btnLogo2 = document.getElementById('btnLogo2');
  if(btnLogo1) tryLoad(logoPaths, btnLogo1);
  if(btnLogo2) tryLoad(logoPaths, btnLogo2);

  // build slides (tv images)
  const slidesEl = document.getElementById('slides');
  slideBases.forEach(base=>{
    const img = document.createElement('img'); img.alt='tv image'; img.loading='lazy';
    slidesEl.appendChild(img);
    tryLoad([base], img);
  });

  // dots
  const dotsEl = document.getElementById('dots');
  function buildDots(){
    dotsEl.innerHTML='';
    for(let i=0;i<slidesEl.children.length;i++){
      const d = document.createElement('div'); d.className='dot'+(i===0?' active':''); d.style.cursor='pointer';
      d.addEventListener('click', ()=>{ idx = i; updateSlide(); });
      dotsEl.appendChild(d);
    }
  }

  // slider logic
  let idx = 0;
  function updateSlide(){ if(!slidesEl.children.length) return; slidesEl.style.transform = `translateX(${-idx*100}%)`; Array.from(dotsEl.children).forEach((d,i)=> d.classList.toggle('active', i===idx)); }
  document.getElementById('prevBtn').addEventListener('click', ()=>{ if(!slidesEl.children.length) return; idx = (idx - 1 + slidesEl.children.length) % slidesEl.children.length; updateSlide(); });
  document.getElementById('nextBtn').addEventListener('click', ()=>{ if(!slidesEl.children.length) return; idx = (idx + 1) % slidesEl.children.length; updateSlide(); });

  // swipe
  (function(){
    let startX=null;
    const c = document.getElementById('carousel');
    c.addEventListener('touchstart', e=> startX = e.changedTouches[0].clientX, {passive:true});
    c.addEventListener('touchend', e=> {
      if(startX===null) return;
      const dx = e.changedTouches[0].clientX - startX;
      if(Math.abs(dx)>40){
        if(dx<0) idx = Math.min(idx+1, slidesEl.children.length-1); else idx = Math.max(idx-1,0);
        updateSlide();
      }
      startX=null;
    }, {passive:true});
  })();

  setTimeout(()=>{ buildDots(); updateSlide(); }, 350);

  // ---------------- language toggle ----------------
  let lang = 'en';
  const langEn = document.getElementById('langEn'), langGu = document.getElementById('langGu');
  langEn.addEventListener('click', ()=>{ lang='en'; langEn.classList.add('active'); langGu.classList.remove('active'); document.getElementById('panelSub').textContent='Tap mic or type your question'; });
  langGu.addEventListener('click', ()=>{ lang='gu'; langGu.classList.add('active'); langEn.classList.remove('active'); document.getElementById('panelSub').textContent='‡™Æ‡™æ‡™á‡™ï ‡™¶‡™¨‡™æ‡™µ‡´ã ‡™Ö‡™•‡™µ‡™æ ‡™≤‡™ñ‡´ã'; });

  // ---------------- panel open/close and references ----------------
  const panel = document.getElementById('panel');
  const messagesEl = document.getElementById('messages');
  const inputBox = document.getElementById('inputBox');
  const sendBtn = document.getElementById('sendBtn');
  const micBtn = document.getElementById('micBtn');

  function openPanel(){ panel.style.display='flex'; panel.setAttribute('aria-hidden','false'); setTimeout(()=> { inputBox.focus(); scrollMessagesToBottom(); }, 120); }
  function closePanel(){ panel.style.display='none'; panel.setAttribute('aria-hidden','true'); }
  document.getElementById('closePanel').addEventListener('click', closePanel);

  document.getElementById('askBtn').addEventListener('click', ()=>{ openPanel(); inputBox.focus(); });
  document.getElementById('assistBtn').addEventListener('click', ()=>{ openPanel(); setTimeout(()=> micBtn.click(),220); });

  // ---------- improved Gujarati + English prompt regex (detect both languages properly) ----------
  const PROMPTS = [
    // Price
    { q:/(\bprice\b|\bcost\b|‚Çπ|rupee|rupees|\bpaise\b|\bamount\b|‡™ï‡™ø‡™Ç‡™Æ‡™§|‡™ï‡™ø‡™Ç‡™Æ‡™§‡´ã|‡™¶‡™æ‡™Æ|‡™∞‡´Ç|‡™∞‡´Ç\.?)/i,
      en:'The 43-inch TCL P6K is priced at ‚Çπ35,000 in our showroom (approx). Final price may vary with offers.', 
      gu:'‡™Ü 43\" TCL P6K ‡™ü‡´Ä‡™µ‡´Ä‡™®‡´ã ‡™Ö‡™Ç‡™¶‡™æ‡™ú‡™ø‡™§ ‡™≠‡™æ‡™µ ‚Çπ35,000 ‡™õ‡´á. ‡™Ö‡™Ç‡™§‡™ø‡™Æ ‡™ï‡™ø‡™Ç‡™Æ‡™§ ‡™ì‡™´‡™∞‡™®‡´Ä ‡™™‡™∞‡™ø‡™∏‡´ç‡™•‡™ø‡™§‡™ø ‡™™‡™∞ ‡™Ü‡™ß‡™æ‡™∞ ‡™∞‡™æ‡™ñ‡´á ‡™õ‡´á.' },

    // Dimensions
    { q:/(\bdimension|dimensions|size|width|height|depth|size of|‡™°‡™æ‡™á‡™Æ‡´á‡™®‡´ç‡™∂|‡™Æ‡™æ‡™™|‡™â‡™Ç‡™ö‡™æ‡™à|‡™™‡™π‡´ã‡™≥‡™æ‡™à|‡™ä‡™Ç‡™°‡™æ‡™à|‡™Æ‡™æ‡™™‡´ã)/i,
      en:'Typical dimensions (with stand) are approximately W 83.8 cm √ó H 60.4 cm √ó D 18.45 cm.',
      gu:'‡™∏‡´ç‡™ü‡´Ö‡™®‡´ç‡™° ‡™∏‡™æ‡™•‡´á ‡™Æ‡™æ‡™™ ‡™≤‡™ó‡™≠‡™ó: ‡™™‡™π‡´ã‡™≥‡™æ‡™à 83.8 ‡™∏‡´á‡™Æ‡´Ä √ó ‡™ä‡™Ç‡™ö‡™æ‡™à 60.4 ‡™∏‡´á‡™Æ‡´Ä √ó ‡™ä‡™Ç‡™°‡™æ‡™à 18.45 ‡™∏‡´á‡™Æ‡´Ä.' },

    // Features
    { q:/(\bfeature|features|spec|specs|what .* include|‡™µ‡™ø‡™∂‡´á‡™∑‡™§‡™æ|‡™´‡´Ä‡™ö‡™∞|‡™≤‡™ï‡´ç‡™∑‡™£)/i,
      en:'Key features: 4K UHD, HDR10, Google TV, AiPQ processor, Dolby Audio, HDMI 2.1 (gaming friendly).',
      gu:'‡™Æ‡´Å‡™ñ‡´ç‡™Ø ‡™≤‡™ï‡´ç‡™∑‡™£‡´ã: 4K UHD, HDR10, Google TV, AiPQ ‡™™‡´ç‡™∞‡´ã‡™∏‡´á‡™∏‡™∞, Dolby Audio ‡™Ö‡™®‡´á HDMI 2.1.' },

    // Colors
    { q:/(\bcolor|colour|available color|colour available|‡™∞‡™Ç‡™ó|‡™ï‡™Ø‡´ã ‡™∞‡™Ç‡™ó)/i,
      en:'This model commonly comes in a black/graphite finish; exact colors depend on stock.',
      gu:'‡™Ü ‡™Æ‡´ã‡™°‡™≤ ‡™∏‡™æ‡™Æ‡™æ‡™®‡´ç‡™Ø ‡™∞‡´Ä‡™§‡´á ‡™ï‡™æ‡™≥‡™æ/‡™ó‡´ç‡™∞‡™æ‡™´‡™æ‡™á‡™ü ‡™∞‡™Ç‡™ó‡™Æ‡™æ‡™Ç ‡™Æ‡™≥‡´á ‡™õ‡´á. ‡™ö‡´ã‡™ï‡´ç‡™ï‡™∏ ‡™∞‡™Ç‡™ó ‡™∏‡´ç‡™ü‡´ã‡™ï ‡™™‡™∞ ‡™Ü‡™ß‡™æ‡™∞ ‡™∞‡™æ‡™ñ‡´á ‡™õ‡´á.' },

    // Gaming
    { q:/(\bgame|gaming|is it good for game|input lag|‡™ó‡´á‡™Æ|‡™ó‡´á‡™Æ‡™ø‡™Ç‡™ó)/i,
      en:'Yes ‚Äî HDMI 2.1, Game Mode and ALLM reduce input lag. Native refresh is 60Hz; MEMC helps motion.',
      gu:'‡™π‡™æ ‚Äî HDMI 2.1, ‡™ó‡´á‡™Æ ‡™Æ‡´ã‡™° ‡™Ö‡™®‡´á ALLM ‡™á‡™®‡™™‡´Å‡™ü ‡™≤‡´á‡™ó ‡™ò‡™ü‡™æ‡™°‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡´á ‡™õ‡´á. ‡™Æ‡´Ç‡™≥ ‡™∞‡™ø‡™´‡´ç‡™∞‡´á‡™∂ 60Hz ‡™õ‡´á.' },

    // Feedback/reviews
    { q:/(\bfeedback|review|reviews|customer|rating|‡™™‡´ç‡™∞‡™§‡™ø‡™∏‡™æ‡™¶|‡™∏‡™Æ‡´Ä‡™ï‡´ç‡™∑‡™æ|‡™∞‡™ø‡™µ‡´ç‡™Ø‡´Ç)/i,
      en:'Customer feedback typically praises the 4K clarity and value; some mention moderate peak brightness.',
      gu:'‡™ó‡´ç‡™∞‡™æ‡™π‡™ï‡´ã ‡™∏‡™æ‡™Æ‡™æ‡™®‡´ç‡™Ø ‡™∞‡´Ä‡™§‡´á 4K ‡™∏‡´ç‡™™‡™∑‡´ç‡™ü‡™§‡™æ ‡™Ö‡™®‡´á ‡™ï‡™ø‡™Ç‡™Æ‡™§‡™®‡´á ‡™µ‡™ñ‡™æ‡™£‡´á ‡™õ‡´á; ‡™ï‡´á‡™ü‡™≤‡™æ‡™ï‡´á ‡™Æ‡™ß‡´ç‡™Ø‡™Æ ‡™™‡´Ä‡™ï ‡™¨‡´ç‡™∞‡™æ‡™á‡™ü‡™®‡´á‡™∏ ‡™®‡´ã‡™Ç‡™ß‡´ç‡™Ø‡´ã.' },

    // Power
    { q:/(\bpower|watt|watts|consumption|electricity|‡™µ‡´ã‡™ü|‡™µ‡´ã‡™ü‡´ç‡™∏|‡™µ‡´Ä‡™ú|‡™â‡™™‡™≠‡´ã‡™ó)/i,
      en:'Typical power usage is around 70‚Äì110W during operation; standby is <0.5W.',
      gu:'‡™â‡™™‡™Ø‡´ã‡™ó ‡™¶‡™∞‡™Æ‡™ø‡™Ø‡™æ‡™® ‡™µ‡´Ä‡™ú ‡™ñ‡™∞‡´ç‡™ö ‡™≤‡™ó‡™≠‡™ó 70‚Äì110W ‡™π‡´ã‡™Ø ‡™õ‡´á; ‡™∏‡´ç‡™ü‡´Ö‡™®‡´ç‡™°‡™¨‡™æ‡™Ø <0.5W.' },

    // HDR / Dolby
    { q:/(\bhdr|dolby|dolby audio|hdr10|hdr10\+|‡™¶‡´ã‡™≤‡´ç‡™¨‡´Ä)/i,
      en:'This model supports HDR10 and Dolby Audio (Dolby Vision not supported).',
      gu:'‡™Ü ‡™Æ‡´ã‡™°‡™≤ HDR10 ‡™Ö‡™®‡´á Dolby Audio ‡™∏‡™™‡´ã‡™∞‡´ç‡™ü ‡™ï‡™∞‡´á ‡™õ‡´á (Dolby Vision ‡™â‡™™‡™≤‡™¨‡´ç‡™ß ‡™®‡™•‡´Ä).' },

    // Refresh
    { q:/(\brefresh|hz|60hz|120hz|‡™Æ‡´ã‡™∏‡™®|‡™∞‡™ø‡™´‡´ç‡™∞‡´á‡™∂)/i,
      en:'Native refresh rate is 60Hz. Motion interpolation (MEMC) improves motion handling.',
      gu:'‡™Æ‡´Ç‡™≥ ‡™∞‡™ø‡™´‡´ç‡™∞‡´á‡™∂ ‡™∞‡´á‡™ü 60Hz ‡™õ‡´á. MEMC ‡™Æ‡´ã‡™∂‡™®‡™®‡´á ‡™∏‡™æ‡™∞‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™π‡´á‡™®‡´ç‡™°‡™≤ ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡´á ‡™õ‡´á.' }
  ];

  function findAnswer(text){
    for(const p of PROMPTS) if(p.q.test(text)) return (lang === 'en' ? p.en : p.gu);
    return (lang === 'en' ? "Sorry ‚Äî please ask about price, dimensions, features, colors, gaming, power or HDR." : "‡™Æ‡™æ‡™´ ‡™ï‡™∞‡™∂‡´ã ‚Äî ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™ï‡™ø‡™Ç‡™Æ‡™§, ‡™Æ‡™æ‡™™, ‡™≤‡™ï‡´ç‡™∑‡™£‡´ã, ‡™∞‡™Ç‡™ó‡´ã, ‡™ó‡´á‡™Æ‡™ø‡™Ç‡™ó, ‡™µ‡´Ä‡™ú ‡™ñ‡™∞‡´ç‡™ö ‡™Ö‡™•‡™µ‡™æ HDR ‡™µ‡™ø‡™∂‡´á ‡™™‡´Ç‡™õ‡´ã.");
  }

  // ---------- messages (typing & send) ----------
  function pushMessage(text, who='bot'){
    if(!text) return;
    const el = document.createElement('div'); el.className = 'bubble ' + (who==='user' ? 'user' : 'bot'); el.textContent = text;
    messagesEl.appendChild(el); scrollMessagesToBottom();
  }

  sendBtn.addEventListener('click', function(){
    const v = inputBox.value && inputBox.value.trim();
    if(!v) return;
    inputBox.value = '';
    pushMessage(v, 'user');
    const ans = findAnswer(v);
    setTimeout(()=> { pushMessage(ans,'bot'); speak(ans); }, 180);
  });
  inputBox.addEventListener('keydown', function(e){ if(e.key === 'Enter'){ e.preventDefault(); sendBtn.click(); } });

  // ---------- speech recognition & synthesis ----------
  let recognition = null, listening=false;
  if(window.SpeechRecognition || window.webkitSpeechRecognition){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.interimResults = false; recognition.maxAlternatives = 1;
    recognition.onresult = function(e){
      const txt = (e.results && e.results[0] && e.results[0][0] && e.results[0][0].transcript) || '';
      if(txt){
        pushMessage(txt,'user');
        const ans = findAnswer(txt);
        setTimeout(()=> { pushMessage(ans,'bot'); speak(ans); }, 180);
      }
    };
    recognition.onend = function(){ listening=false; micBtn.textContent='üé§'; micBtn.style.transform=''; micBtn.style.boxShadow=''; };
    recognition.onerror = function(){ listening=false; micBtn.textContent='üé§'; micBtn.style.transform=''; micBtn.style.boxShadow=''; };
  }

  micBtn.addEventListener('click', function(){
    if(!recognition){ alert(lang==='en' ? 'Speech recognition not supported in this browser.' : '‡™Ü ‡™¨‡´ç‡™∞‡™æ‡™â‡™ù‡™∞ ‡™Æ‡™æ‡™Ç ‡™∏‡´ç‡™™‡´Ä‡™ö ‡™∞‡´á‡™ï‡´ã‡™ó‡´ç‡™®‡™ø‡™∂‡™® ‡™∏‡™™‡´ã‡™∞‡´ç‡™ü ‡™®‡™•‡´Ä.'); return; }
    if(!listening){
      try{
        recognition.lang = (lang === 'en' ? 'en-IN' : 'gu-IN');
        recognition.start(); listening=true; micBtn.textContent='‚óè'; micBtn.style.transform='scale(1.03)'; micBtn.style.boxShadow='0 8px 28px rgba(255,122,90,0.12)';
      }catch(e){ listening=false; }
    } else { recognition.stop(); listening=false; micBtn.textContent='üé§'; micBtn.style.transform=''; micBtn.style.boxShadow=''; }
  });

  function speak(text){
    if(!('speechSynthesis' in window)) return;
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = (lang === 'en' ? 'en-IN' : 'gu-IN');
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }catch(e){}
  }

  // ---------- mobile keyboard handling: scroll messages & adjust panel when keyboard appears ----------
  function scrollMessagesToBottom(){ try{ messagesEl.scrollTop = messagesEl.scrollHeight; }catch(e){} }
  // when input is focused, ensure messages are visible
  inputBox.addEventListener('focus', ()=> setTimeout(scrollMessagesToBottom, 300));
  // when window resizes (mobile keyboard often causes resize), scroll messages
  window.addEventListener('resize', ()=> setTimeout(scrollMessagesToBottom, 220));

  // ---------- initial greeting ----------
  setTimeout(()=> pushMessage(lang==='en' ? 'Hello ‚Äî tap Product Assistant for voice or Ask Me to type a question.' : '‡™π‡´á‡™≤‡´ã ‚Äî ‡™Ö‡™µ‡™æ‡™ú ‡™Æ‡™æ‡™ü‡´á Product Assistant ‡™¶‡™¨‡™æ‡™µ‡´ã ‡™Ö‡™•‡™µ‡™æ ‡™≤‡™ñ‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á Ask Me ‡™¶‡™¨‡™æ‡™µ‡´ã.'), 500);

  // ensure interactive touch behavior
  ['prevBtn','nextBtn','askBtn','assistBtn','langEn','langGu','micBtn','sendBtn'].forEach(id=>{
    const el = document.getElementById(id); if(el) el.style.touchAction='manipulation';
  });
});
</script>
</body>
</html>
