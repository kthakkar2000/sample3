<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kalindi тАФ Samsung washing machine 12kg</title>
<style>
:root{
  --bg:#0f1723; --card:#0b1220; --muted:#9aa4b2;
  --accent1:#7c3aed; --accent2:#06b6d4;
  font-family:Inter,system-ui,-apple-system,Roboto,'Segoe UI',Arial;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#081018);color:#e6eef6}
.container{max-width:460px;margin:18px auto;padding:16px}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;position:relative;z-index:30}
.left{display:flex;gap:12px;align-items:center}
.logo-img{width:84px;height:84px;border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(2,6,23,0.6);background:#fff;flex-shrink:0}
.logo-img img{width:100%;height:100%;object-fit:contain}
.title-wrap{line-height:1}
.shop{font-size:18px;font-weight:800}
.sub{font-size:12px;color:var(--muted)}
.lang-switch{display:flex;gap:8px}
.lang-btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);font-weight:700;cursor:pointer;outline:none}
.lang-btn.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 10px 28px rgba(124,58,237,0.12)}
.lang-btn:focus{box-shadow:0 0 0 3px rgba(7,125,255,0.12)}

.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:18px;padding:12px;box-shadow:0 14px 40px rgba(2,6,23,0.6)}
.gallery{position:relative;overflow:hidden;border-radius:14px}
.slides{display:flex;transition:transform .36s cubic-bezier(.2,.9,.2,1)}
.slides img{width:100%;height:320px;object-fit:cover;flex-shrink:0;background:#071018}
.dots{display:flex;gap:6px;position:absolute;left:12px;bottom:10px;z-index:15}
.dot{width:9px;height:9px;border-radius:6px;background:rgba(255,255,255,0.06)}
.dot.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));box-shadow:0 6px 18px rgba(6,182,212,0.08)}

.product-name{font-weight:900;font-size:18px;margin-top:12px;text-align:center}
.small-muted{color:var(--muted);font-size:13px;margin-top:6px;text-align:center}

.bot{display:flex;gap:12px;align-items:center;margin-top:14px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(124,58,237,0.05), rgba(6,182,212,0.03));position:relative;z-index:20}
.mic{width:58px;height:58px;border-radius:12px;background:linear-gradient(180deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:22px;cursor:pointer;flex-shrink:0;border:0}
.mic.listening{box-shadow:0 16px 48px rgba(124,58,237,0.18);transform:scale(1.04)}
.bot-info{flex:1}
.bot-title{font-weight:800}
.bot-sub{font-size:13px;color:var(--muted);margin-top:6px}
.transcript{margin-top:8px;font-size:14px;color:var(--muted);min-height:46px}

/* CHAT UI */
.chat{margin-top:16px;background:rgba(255,255,255,0.02);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:12px}
.chat-messages{max-height:260px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding-right:6px}
.msg{padding:10px;border-radius:10px;max-width:85%;font-size:14px;line-height:1.4}
.msg.user{align-self:flex-end;background:linear-gradient(90deg,var(--accent2),#10b981);color:#042022}
.msg.bot{align-self:flex-start;background:rgba(255,255,255,0.06);color:#e6eef6}
.chat-input{display:flex;gap:8px}
.chat-input input{flex:1;padding:10px;border-radius:8px;border:0;font-size:14px;background:rgba(255,255,255,0.02);color:inherit}
.chat-input button{padding:10px 12px;border:0;border-radius:8px;cursor:pointer;font-size:14px}
#chatSend{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white}
#chatMic{background:#222;color:#eee}

/* small responsive tweak */
@media (max-width:420px){ .slides img{height:260px} .logo-img{width:64px;height:64px} .shop{font-size:15px} }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="left">
        <div class="logo-img"><img id="logoImg" src="assets/ktpl-new-logo.png" alt="Kalindi logo"/></div>
        <div class="title-wrap">
          <div class="shop">Kalindi Tradelinks Pvt Ltd</div>
          <div class="sub">Home Appliances тАв Washing Machine</div>
        </div>
      </div>

      <div class="lang-switch" role="tablist" aria-label="Language">
        <button class="lang-btn active" id="btn-en" aria-selected="true">English</button>
        <button class="lang-btn" id="btn-gu" aria-selected="false">ркЧрлБркЬрк░рк╛ркдрлА</button>
      </div>
    </header>

    <main class="card">
      <div class="gallery" id="gallery">
        <div class="slides" id="slides">
          <img src="assets/wm1.jpg" alt="product image 1" />
          <img src="assets/wm2.jpg" alt="product image 2" />
          <img src="assets/wm3.jpg" alt="product image 3" />
          <img src="assets/wm4.jpg" alt="product image 4" />
          <img src="assets/wm5.jpg" alt="product image 5" />
        </div>
        <div class="dots" id="dots" aria-hidden="true"></div>
      </div>

      <div class="product-name">Samsung washing machine 12kg</div>
      <div class="small-muted">Tap the mic and ask. Responses available in English and Gujarati.</div>

      <div class="bot" role="region" aria-label="Product voice assistant">
        <button class="mic" id="mic" title="Tap to speak" aria-pressed="false">ЁЯОЩя╕П</button>
        <div class="bot-info">
          <div class="bot-title" id="assistant-title">Product Voice Assistant</div>
          <div class="bot-sub" id="assistant-sub">Select language, tap mic and ask about price, warranty, usage and more.</div>
          <div class="transcript" id="transcript">Assistant ready. Select language and tap mic to ask.</div>
        </div>
      </div>

      <!-- Chat area (typing + chat mic) -->
      <div class="chat" id="chat">
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input">
          <input id="chatInput" type="text" placeholder="Type your question..." aria-label="Type question">
          <button id="chatSend" title="Send">Send</button>
          <button id="chatMic" title="Tap to speak from chat">ЁЯОЩя╕П</button>
        </div>
      </div>

    </main>

    <footer>┬й Kalindi Tradelinks Pvt Ltd</footer>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ---------------- PRODUCT DATA (edit here if you want) ---------------- */
  // Single product inline config (template for QR / multiple products approach can load JSON instead)
  const PRODUCT = {
    id: 'samsung-12kg',
    title: 'Samsung washing machine 12kg',
    images: ['assets/wm1.jpg','assets/wm2.jpg','assets/wm3.jpg','assets/wm4.jpg','assets/wm5.jpg'],
    price: 'тВ╣65,000',
    specs: {
      capacity: '12 kg',
      energy: '5 Star',
      rpm: '1200',
      warranty: '2 years',
      dimensions: 'H 85 cm ├Ч W 60 cm ├Ч D 55тАУ70 cm',
      inverter: 'Digital Inverter Motor',
      dryer: 'Some variants have dryer function',
      water_per_cycle: '50тАУ70 L',
      power_per_cycle: '1.2тАУ1.5 kWh'
    },
    description_en: 'Samsung 12 kg front-load washers combine AI wash optimisation, Digital Inverter motor, Quick/Eco programs, and SmartThings on select models.',
    description_gu: 'Samsung 12 kg рклрлНрк░ркирлНркЯ-рк▓рлЛркб рк╡рлЛрк╢рк░рлНрк╕ркорк╛ркВ AI рк╡рлЛрк╢, ркбрк┐ркЬрк┐ркЯрк▓ ркЗркирк╡рк░рлНркЯрк░ ркорлЛркЯрк░, ркХрлНрк╡рк┐ркХ/ркПркХрлЛ рккрлНрк░рлЛркЧрлНрк░рк╛рко ркЕркирлЗ ркХрлЗркЯрк▓рк╛ркВркХ ркорлЛркбрлЗрк▓ркорк╛ркВ SmartThings рк╕рккрлЛрк░рлНркЯ рк╣рлЛркп ркЫрлЗ.',
    // product-specific prompts (regex-like string 'q' will be used with RegExp)
    prompts: [
      { q: 'price|cost|тВ╣|rupee', en: 'The price of this model is тВ╣65,000. Offers and final price may vary in-store.', gu: 'ркЖ ркорлЛркбрлЗрк▓ркирлА ркХрк┐ркВркоркд рк░рлВ. 65,000 ркЫрлЗ. рк╕рлНркЯрлЛрк░ркорк╛ркВ ркУрклрк░рлНрк╕ ркЕркирлБрк╕рк╛рк░ ркЕркВркдрк┐рко ркХрк┐ркВркоркд ркмркжрк▓рлА рк╢ркХрлЗ ркЫрлЗ.' },
      { q: 'stock|available', en: 'Stock varies by store. Please call or visit our shop to confirm availability.', gu: 'рк╕рлНркЯрлЛркХ рк╕рлНркЯрлЛрк░рк╕ рккрк░ ркЖркзрк╛рк░ рк░рк╛ркЦрлЗ ркЫрлЗ. ркХрлГрккрк╛ ркХрк░рлАркирлЗ рк╕рлНркЯрлЛрк░ркорк╛ркВ ркдрккрк╛рк╕рлЛ.' },
      { q: 'describe|description|details|model description|all description', en: PRODUCT?.description_en || '', gu: PRODUCT?.description_gu || '' },
      { q: 'usage|how to use|how do i use|what is the use', en: 'Load clothes evenly, use recommended detergent, select appropriate program and avoid overloading.', gu: 'ркХрккркбрк╛ркВ рк╕ркорк╛рки рк░рлАркдрлЗ рк▓рлЛркб ркХрк░рлЛ, рк╕рлВркЪрк┐ркд ркбрк┐рк╕рк░рлНркЯ ркЬрк╛ркирлЛ ркЙрккркпрлЛркЧ ркХрк░рлЛ ркЕркирлЗ ркУрк╡рк░рк▓рлЛркб ркЯрк╛рк│рлЛ.' },
      { q: 'water|litre|consumption', en: 'Approx 50тАУ70 litres per full wash depending on program.', gu: 'рккрлНрк░рлЛркЧрлНрк░рк╛рко рккрк░ ркЖркзрк╛рк░ рк░рк╛ркЦрлАркирлЗ рк▓ркЧркнркЧ 50тАУ70 рк▓рк┐ркЯрк░ рккрк╛ркгрлА рк╡рккрк░рк╛ркп ркЫрлЗ.' },
      { q: 'colour|color|available color|which color', en: 'Common colours: Pearl White, Graphite Silver тАФ availability depends on stock.', gu: 'рккрлНрк░рк╛рккрлНркд рк░ркВркЧрлЛ: рккрк░рлНрк▓ рк╡рлНрк╣рк╛ркЗркЯ, ркЧрлНрк░рк╛рклрк╛ркЗркЯ рк╕рк┐рк▓рлНрк╡рк░ тАФ рк╕рлНркЯрлЛркХ рккрк░ ркЖркзрк╛рк░.' },
      { q: 'dimension|size|height|width|depth', en: 'Approx dimensions: H 85 cm ├Ч W 60 cm ├Ч D 55тАУ70 cm (model dependent).', gu: 'ркЕркВркжрк╛ркЬрлАркд ркорк╛ркк: ркКркВркЪрк╛ркИ 85 cm ├Ч рккрк╣рлЛрк│рк╛ркИ 60 cm ├Ч ркКркВркбрк╛ркИ 55тАУ70 cm (ркорлЛркбрлЗрк▓ ркорлБркЬркм).' },
      { q: 'electric|power|watt|energy|consumption', en: 'Typical energy per full wash is around 1.2тАУ1.5 kWh; Eco/AI modes reduce consumption.', gu: 'рккрлВрк░ркирк╛ рк╡рлЛрк╢ ркорк╛ркЯрлЗ рк╕рк╛ркорк╛ркирлНркп рк░рлАркдрлЗ ~1.2тАУ1.5 kWh ркКрк░рлНркЬрк╛ ркЦрк░рлНркЪ ркерк╛ркп ркЫрлЗ; ркПркХрлЛ ркорлЛркб energie ркмркЪрк╛рк╡рлЗ ркЫрлЗ.' },
      { q: 'dryer|dry function|dryer function', en: 'Some Samsung variants are washer-dryer combos тАФ check the specific model for dryer capability.', gu: 'ркХрлЗркЯрк▓рк╛ркВркХ ркорлЛркбрлЗрк▓рлЛ рк╡рлЛрк╢рк░-ркбрлНрк░рк╛ркпрк░ ркХрлЙркорлНркмрлЛ ркЫрлЗ тАФ ркЪрлЛркХрлНркХрк╕ ркорлЛркбрлЗрк▓ ркдрккрк╛рк╕рлЛ.' },
      { q: 'inverter|digital inverter|motor', en: 'Yes тАФ modern Samsung front-load machines use a Digital Inverter Motor for efficiency and durability.', gu: 'рк╣рк╛ркВ тАФ ркЖркзрлБркирк┐ркХ ркорк╢рлАркирлЛркорк╛ркВ ркбрк┐ркЬрк┐ркЯрк▓ ркЗркирк╡рк░рлНркЯрк░ ркорлЛркЯрк░ рк╣рлЛркп ркЫрлЗ ркЬрлЗ рк╡ркзрлБ ркХрк╛рк░рлНркпркХрлНрк╖рко ркЕркирлЗ ркЯркХрк╛ркЙ рк╣рлЛркп ркЫрлЗ.' },
      { q: 'family|how many family|suitable for', en: '12 kg is suitable for medium to large families (4+ members) and handles bedding and blankets comfortably.', gu: '12 kg ркоркзрлНркпрко ркерлА ркорлЛркЯрк╛ рккрк░рк┐рк╡рк╛рк░ (4+ рк╕ркнрлНркпрлЛ) ркорк╛ркЯрлЗ ркпрлЛркЧрлНркп ркЫрлЗ ркЕркирлЗ ркмрлЗркбрк┐ркВркЧ/ркмрлНрк▓рлЗркирлНркХрлЗркЯ рк╕рк░рк│ркдрк╛ркерлА ркзрлЛркИ рк╢ркХрлЗ ркЫрлЗ.' },
      { q: 'display|digital|wifi|smartthings|smart', en: 'Selected models include a digital display and Wi-Fi / SmartThings support for remote control; check model spec.', gu: 'ркХрлЗркЯрк▓рк╛ркВркХ ркорлЛркбрлЗрк▓рлЛ ркбрк┐рк╕рлНрккрлНрк▓рлЗ ркЕркирлЗ Wi-Fi / SmartThings рк╕рккрлЛрк░рлНркЯ рк╕рк╛ркерлЗ ркЖрк╡рлЗ ркЫрлЗ; ркЪрлЛркХрлНркХрк╕ ркорлЛркбрлЗрк▓ ркдрккрк╛рк╕рлЛ.' },
      { q: 'advantages|benefit|why should i buy|why buy', en: 'Advantages: large capacity, efficient digital inverter motor, advanced wash programs (Quick/Eco/Steam), and optional smart features for convenience.', gu: 'рк▓рк╛ркн: ркорлЛркЯрлА ркХрлНрк╖ркоркдрк╛, ркХрк╛рк░рлНркпркХрлНрк╖рко ркЗркирк╡рк░рлНркЯрк░ ркорлЛркЯрк░, ркЕркжрлНркпркдрки рккрлНрк░рлЛркЧрлНрк░рк╛рко ркЕркирлЗ ркХрлЗркЯрк▓рк╛ркХ ркорлЛркбрлЗрк▓рлЛркорк╛ркВ рк╕рлНркорк╛рк░рлНркЯ рк╕рлБрк╡рк┐ркзрк╛ркУ.' },
      { q: 'smaller|instead of a smaller capacity|why not smaller', en: 'A 12kg handles bulky items and heavy loads in fewer cycles тАФ saving time and energy versus smaller machines.', gu: '12 kg ркорлЛркЯрк╛/ркнрк╛рк░рлЗ рк▓рлЛркбркирлЗ ркУркЫрк╛ рк╕рк╛ркпркХрк▓ркорк╛ркВ ркзрлЛркИ рк╢ркХрлЗ ркЫрлЗ тАФ рк╕ркоркп ркЕркирлЗ ркКрк░рлНркЬрк╛ ркмркЪрк╛рк╡рлЗ ркЫрлЗ.' },
      { q: 'programs|quick wash|eco wash|special programs', en: 'Yes тАФ many models include Quick Wash, Eco mode, Hygiene/Steam cycles and program presets for delicates and bedding.', gu: 'рк╣рк╛ркВ тАФ ркХрлНрк╡рк┐ркХ рк╡рлЛрк╢, ркПркХрлЛ ркорлЛркб ркЕркирлЗ рк╕рлНркЯрлАрко/рк╣рк╛ркИркЬрлАрки рккрлНрк░рлЛркЧрлНрк░рк╛рко ркШркгрк╛ ркорлЛркбрлЗрк▓рлЛ ркзрк░рк╛рк╡рлЗ ркЫрлЗ.' },
      { q: 'heavy loads|blankets|curtains', en: 'Yes тАФ this 12 kg machine is designed to handle blankets, curtains and other bulky items comfortably.', gu: 'рк╣рк╛ тАФ 12 kg ркорк╢рлАрки ркнрк╛рк░рлЗрк▓рлБркВ рк▓рлЛркб ркЕркирлЗ ркмрлЗркбрк┐ркВркЧ рк╕рк░рк│ркдрк╛ркерлА рк╣рлЗркирлНркбрк▓ ркХрк░рлЗ ркЫрлЗ.' },
      { q: 'feedback|reviews|customer review|customer feedback', en: 'Sample customer feedback: 1) Great cleaning and gentle on clothes. 2) Large drum тАФ perfect for bedding. 3) Smart features are useful. 4) Quiet and low vibration.', gu: 'ркЧрлНрк░рк╛рк╣ркХ рккрлНрк░ркдрк┐рк╕рк╛ркж: 1) рк╕рк╛рк░рлА рк╕рк╛рклрк╕рклрк╛ркЗ. 2) ркорлЛркЯрлА ркбрлНрк░рко. 3) рк╕рлНркорк╛рк░рлНркЯ рклрлАркЪрк░рлНрк╕ ркЙрккркпрлЛркЧрлА. 4) рк╢рк╛ркВркд ркУрккрк░рлЗрк╢рки.' }
    ]
  };
  /* ---------------- end PRODUCT ---------------- */

  // fill product title (if you want dynamic)
  document.querySelector('.product-name').textContent = PRODUCT.title;

  /* ---------------- slider ---------------- */
  const slidesEl = document.getElementById('slides');
  const dotsEl = document.getElementById('dots');

  // ensure slides match PRODUCT.images (only if needed)
  (function populateSlides(){
    slidesEl.innerHTML = '';
    PRODUCT.images.forEach(src => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = PRODUCT.title;
      slidesEl.appendChild(img);
    });
  })();

  let idx = 0;
  function buildDots(){
    dotsEl.innerHTML = '';
    const imgs = slidesEl.querySelectorAll('img');
    imgs.forEach((_,i) => {
      const d = document.createElement('div');
      d.className = 'dot' + (i===0 ? ' active' : '');
      d.addEventListener('click', ()=> { idx = i; updateSlide(); });
      dotsEl.appendChild(d);
    });
  }
  function updateSlide(){
    slidesEl.style.transform = `translateX(${-idx*100}%)`;
    Array.from(dotsEl.children).forEach((d,i)=> d.classList.toggle('active', i===idx));
  }
  buildDots();
  setInterval(()=> { const imgs = slidesEl.querySelectorAll('img'); if(imgs.length) { idx = (idx+1) % imgs.length; updateSlide(); } }, 4500);
  // swipe
  let startX = null;
  const gallery = document.getElementById('gallery');
  gallery.addEventListener('touchstart', e => startX = e.changedTouches[0].clientX);
  gallery.addEventListener('touchend', e => {
    if(startX === null) return;
    const endX = e.changedTouches[0].clientX; const dx = endX - startX;
    if(Math.abs(dx) > 40){
      const imgs = slidesEl.querySelectorAll('img');
      if(dx < 0) idx = Math.min(idx+1, imgs.length-1); else idx = Math.max(idx-1,0);
      updateSlide();
    }
    startX = null;
  });

  /* ---------------- language toggle ---------------- */
  let currentLang = 'en';
  const btnEn = document.getElementById('btn-en'), btnGu = document.getElementById('btn-gu');
  function setLang(lang){
    currentLang = lang;
    if(lang === 'en'){ btnEn.classList.add('active'); btnGu.classList.remove('active'); document.getElementById('assistant-sub').textContent = 'Select language, tap mic and ask about price, warranty, usage and more.'; }
    else { btnGu.classList.add('active'); btnEn.classList.remove('active'); document.getElementById('assistant-sub').textContent = 'ркнрк╛рк╖рк╛ рккрк╕ркВркж ркХрк░рлЛ, ркорк╛ркИркХ ркжркмрк╛рк╡рлЛ ркЕркирлЗ рккрлНрк░рк╢рлНрки рккрлВркЫрлЛ.'; }
    // update recognition language when active
    if(recognition) recognition.lang = (currentLang === 'en' ? 'en-IN' : 'gu-IN');
  }
  btnEn.addEventListener('click', ()=> setLang('en'));
  btnGu.addEventListener('click', ()=> setLang('gu'));

  /* ---------------- speech synthesis and tap sound ---------------- */
  function speak(text, langTag='en-IN'){
    if(!('speechSynthesis' in window)) return;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = langTag;
    u.rate = 1;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }
  let audioCtx = null;
  function playTap(){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      o.frequency.setValueAtTime(1000, now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.12, now + 0.001);
      g.gain.exponentialRampToValueAtTime(0.001, now + 0.12);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(now); o.stop(now + 0.14);
    }catch(e){ console.warn('tap sound', e && e.message); }
  }

  /* ---------------- prompt matching ---------------- */
  function matchProductPrompt(text){
    if(!PRODUCT.prompts) return null;
    const q = text.toLowerCase();
    for(const p of PRODUCT.prompts){
      try{
        const re = new RegExp(p.q, 'i');
        if(re.test(q)) return currentLang === 'en' ? p.en : p.gu;
      }catch(e){
        if(q.indexOf(p.q.toLowerCase()) !== -1) return currentLang === 'en' ? p.en : p.gu;
      }
    }
    return null;
  }

  // global fallback prompts
  const globalPrompts = [
    { q: /price|cost|тВ╣|rupee/i, en: PRODUCT.price || 'Price not available', gu: PRODUCT.price ? PRODUCT.price + ' (рк╕рлНркЯрлЛрк░ рккрк░ ркЖркзрк╛рк░рк┐ркд)' : 'ркорлВрк▓рлНркп ркЙрккрк▓ркмрлНркз ркиркерлА' },
    { q: /warrant(?:y|ies)|guarantee/i, en: '2 year manufacturer warranty typically; check exact model.', gu: 'рк╕рк╛ркорк╛ркирлНркп рк░рлАркдрлЗ 2 рк╡рк░рлНрк╖ркирлА рк╡рлЛрк░ркВркЯрлА ркорк│рлЗ ркЫрлЗ; ркЪрлЛркХрлНркХрк╕ ркорлЛркбрлЗрк▓ ркдрккрк╛рк╕рлЛ.' },
    { q: /service|repair|support/i, en: 'We provide doorstep service and free checkups during warranty (check store).', gu: 'рк╡рлЛрк░ркВркЯрлА ркжрк░ркорк┐ркпрк╛рки ркбрлЛрк░рк╕рлНркЯрлЗркк рк╕рк░рлНрк╡рк┐рк╕ ркЕркирлЗ ркорклркд ркЪрлЗркХркЕркк ркЖрккрк╡рк╛ркорк╛ркВ ркЖрк╡рлЗ ркЫрлЗ.' }
  ];
  function matchGlobal(text){
    const q = text.toLowerCase();
    for(const g of globalPrompts){
      if(g.q.test(q)) return currentLang === 'en' ? g.en : g.gu;
    }
    return null;
  }

  /* ---------------- Chat helpers ---------------- */
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const chatSend = document.getElementById('chatSend');
  const chatMic = document.getElementById('chatMic');
  function addMessage(text, who='user'){
    const d = document.createElement('div'); d.className = 'msg ' + who; d.textContent = text;
    chatMessages.appendChild(d); chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function respond(answerText){
    const prefix = currentLang === 'en' ? 'Assistant: ' : 'рк╕рк╣рк╛ркпркХ: ';
    document.getElementById('transcript').textContent = prefix + answerText;
    addMessage(answerText, 'bot');
    // speak answer
    speak(answerText, currentLang === 'en' ? 'en-IN' : 'gu-IN');
  }

  /* ---------------- recognition (speech-to-text) ---------------- */
  let recognition = null;
  let lastHeard = false;
  if(window.SpeechRecognition || window.webkitSpeechRecognition){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SR();
    recognition.lang = 'en-IN';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = (e) => {
      lastHeard = true;
      const text = e.results[0][0].transcript;
      // show recognized text as user in chat and handle
      addMessage(text, 'user');
      handleUserQuery(text);
    };

    recognition.onend = () => {
      document.getElementById('mic').classList.remove('listening');
      if(!lastHeard){
        document.getElementById('transcript').textContent = (currentLang === 'en' ? 'Tap mic to speak' : 'ркорк╛ркЗркХ ркжркмрк╛рк╡рлЛ ркЕркирлЗ ркмрлЛрк▓рлЛ');
      }
      lastHeard = false;
    };

    recognition.onerror = (ev) => {
      document.getElementById('transcript').textContent = 'Error: ' + (ev.error || ev.message);
      document.getElementById('mic').classList.remove('listening');
      lastHeard = false;
    };
  }

  /* ---------------- main query handler ---------------- */
  function handleUserQuery(text){
    // try product prompts
    const pAns = matchProductPrompt(text);
    if(pAns){ respond(pAns); return; }
    const gAns = matchGlobal(text);
    if(gAns){ respond(gAns); return; }
    // fallback generic answer
    const fallback = currentLang === 'en' ? 'Sorry, I do not have that exact information. Ask about price, usage, water consumption, warranty or features.' : 'ркорк╛ркл ркХрк░рк╢рлЛ, ркорк╛рк░рлА рккрк╛рк╕рлЗ ркдрлЗ ркЪрлЛркХрлНркХрк╕ ркорк╛рк╣рк┐ркдрлА ркЙрккрк▓ркмрлНркз ркиркерлА. ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркХрк┐ркВркоркд, ркЙрккркпрлЛркЧ, рккрк╛ркгрлА ркЙрккркпрлЛркЧ, ркЕркерк╡рк╛ рк╡рлЛрк░ркВркЯрлА рк╡рк┐рк╢рлЗ рккрлВркЫрлЛ.';
    respond(fallback);
  }

  /* ---------------- mic (main) behavior ---------------- */
  const micBtn = document.getElementById('mic');
  micBtn.addEventListener('click', () => {
    playTap();
    if(!recognition){
      const q = prompt(currentLang === 'en' ? 'Type your question:' : 'ркдркорк╛рк░рлЛ рккрлНрк░рк╢рлНрки рк▓ркЦрлЛ:');
      if(q){ addMessage(q, 'user'); handleUserQuery(q); }
      return;
    }
    recognition.lang = (currentLang === 'en') ? 'en-IN' : 'gu-IN';
    try{
      lastHeard = false;
      micBtn.classList.add('listening');
      document.getElementById('transcript').textContent = (currentLang === 'en') ? 'Listening...' : 'рк╢рлБркгрк╡рк╛ркорк╛ркВ ркЖрк╡рлА рк░рк╣рлНркпрлБркВ ркЫрлЗ...';
      recognition.start();
    }catch(e){
      micBtn.classList.remove('listening');
      document.getElementById('transcript').textContent = (currentLang === 'en') ? 'Tap mic to speak' : 'ркорк╛ркЗркХ ркжркмрк╛рк╡рлЛ ркЕркирлЗ ркмрлЛрк▓рлЛ';
    }
  });
  micBtn.tabIndex = 0;
  micBtn.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') e.target.click(); });

  /* ---------------- chat typing & chat mic ---------------- */
  chatSend.addEventListener('click', ()=> {
    const text = chatInput.value.trim();
    if(!text) return;
    addMessage(text, 'user');
    chatInput.value = '';
    handleUserQuery(text);
  });
  chatInput.addEventListener('keydown', e => { if(e.key === 'Enter') { e.preventDefault(); chatSend.click(); } });

  chatMic.addEventListener('click', ()=>{
    playTap();
    if(!recognition){
      const q = prompt(currentLang === 'en' ? 'Type your question:' : 'ркдркорк╛рк░рлЛ рккрлНрк░рк╢рлНрки рк▓ркЦрлЛ:');
      if(q){ addMessage(q, 'user'); handleUserQuery(q); }
      return;
    }
    recognition.lang = (currentLang === 'en') ? 'en-IN' : 'gu-IN';
    try{
      lastHeard = false;
      // visually show listening on main mic as well
      micBtn.classList.add('listening');
      document.getElementById('transcript').textContent = (currentLang === 'en') ? 'Listening...' : 'рк╢рлБркгрк╡рк╛ркорк╛ркВ ркЖрк╡рлА рк░рк╣рлНркпрлБркВ ркЫрлЗ...';
      recognition.start();
    }catch(e){}
  });

  /* ---------------- initial UI state ---------------- */
  setLang('en');
  document.getElementById('transcript').textContent = 'Assistant ready. Select language and tap mic to ask.';
  // preload images
  PRODUCT.images.forEach(src => { const i = new Image(); i.src = src; });

}); // DOMContentLoaded end
</script>
</body>
</html>
